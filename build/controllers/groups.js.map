{"version":3,"sources":["../../server/controllers/groups.js"],"names":["createGroup","req","res","body","name","status","send","error","desc","length","Groups","create","admin","decoded","data","id","then","group","userId","GroupUsers","groupId","fetchGroups","isNaN","params","findAll","include","model","Users","through","attributes","as","groups","findOne","where","Messages","findMessages","toGroup","order","messages"],"mappings":"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","file":"groups.js","sourcesContent":["import models from '../models';\n\nexport default {\n  createGroup(req, res) {\n    if (!req.body.name) {\n      res.status(400).send({ error: 'Param name is required', status: 400 });\n      return;\n    }\n    if (req.body.desc === '') {\n      req.body.desc = 'no description';\n    }\n    if (req.body.name.length > 30) {\n      return res.status(400)\n      .send({ error: 'Group name too long', status: 400 });\n    }\n    if (req.body.desc.length > 40) {\n      return res.status(400)\n      .send({ error: 'Group description too long', status: 400 });\n    }\n    return models.Groups\n      .create({\n        name: req.body.name,\n        desc: req.body.desc,\n        admin: req.decoded.data.id\n      })\n      .then((group) => {\n        const userId = req.decoded.data.id;\n        models.GroupUsers\n        .create({ userId, groupId: group.id })\n        .then(res.status(201).send(group));\n      });\n  },\n  fetchGroups(req, res) {\n    if (isNaN(req.params.id)) {\n      return res.status(404).send({ error: 'Route not found', status: 404 });\n    }\n    if (!req.params.id) {\n      return models.Groups\n      .findAll({ include: [{\n        model: models.Users,\n        through: {\n          attributes: ['id', 'username'],\n        },\n        as: 'users'\n      }]\n      })\n      .then(groups => res.status(200).send({ groups }));\n    }\n\n    return models.Groups\n    .findOne({\n      where: { id: req.params.id },\n      attributes: ['id', 'name', 'desc', 'admin'],\n      include: [{\n        model: models.Messages,\n        attributes:\n        [\n          'id',\n          'fromUser',\n          'message',\n          'createdAt',\n          'priority',\n          'readBy'\n        ],\n        as: 'messages'\n      },\n      { model: models.Users,\n        attributes: ['id', 'username', 'createdAt'],\n        through: {\n          attributes: []\n        },\n        as: 'users'\n      }]\n    })\n    .then((group) => {\n      if (!group) {\n        return res.status(404)\n        .send({ error: 'Group does not exist', status: 404 });\n      }\n      res.status(200).send(group);\n    });\n  },\n  findMessages(req, res) {\n    models.Messages\n      .findAll({\n        where: { toGroup: [req.params.id] },\n        attributes: [\n          'id',\n          'message',\n          'fromUser',\n          'toGroup',\n          'priority',\n          'readBy'\n        ],\n        order: [\n          ['id', 'ASC']\n        ]\n      })\n      .then(messages => res.status(200)\n      .send({ messages, group: req.params.id }));\n  }\n};\n"]}
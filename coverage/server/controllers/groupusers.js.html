<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for server/controllers/groupusers.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">All files</a> / <a href="index.html">server/controllers</a> groupusers.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
<<<<<<< HEAD
        <span class="strong">23.33% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>7/30</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">21.43% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>3/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">27.27% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>3/11</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">20.69% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>6/29</span>
=======
        <span class="strong">58.82% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>10/17</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">40% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>4/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">80% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>4/5</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">53.33% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>8/15</span>
>>>>>>> b1ace67e1b07e666bbdd8ad156e8bfd1e6a20a55
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
<<<<<<< HEAD
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
=======
40</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
>>>>>>> b1ace67e1b07e666bbdd8ad156e8bfd1e6a20a55
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<<<<<<< HEAD
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
=======
>>>>>>> b1ace67e1b07e666bbdd8ad156e8bfd1e6a20a55
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<<<<<<< HEAD
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
=======
>>>>>>> b1ace67e1b07e666bbdd8ad156e8bfd1e6a20a55
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<<<<<<< HEAD
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
=======
<span class="cline-any cline-no">&nbsp;</span>
>>>>>>> b1ace67e1b07e666bbdd8ad156e8bfd1e6a20a55
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<<<<<<< HEAD
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
=======
>>>>>>> b1ace67e1b07e666bbdd8ad156e8bfd1e6a20a55
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import models from '../models';
&nbsp;
<<<<<<< HEAD
export default <span class="fstat-no" title="function not covered" ><span class="fstat-no" title="function not covered" >{</span></span>
  create(req, res) {
<span class="cstat-no" title="statement not covered" >    if (!req.body.userId) {</span>
<span class="cstat-no" title="statement not covered" >      res.status(400)</span>
      .send({ error: { message: 'Param: "user_id" is required' } });
<span class="cstat-no" title="statement not covered" >      return;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (!req.params.id) {</span>
<span class="cstat-no" title="statement not covered" >      res.status(400)</span>
      .send({ error: { message: 'Param: "group_id" is required' } });
<span class="cstat-no" title="statement not covered" >      return;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    models.GroupUsers</span>
    .find({
      where: {
        userId: req.body.userId,
        groupId: req.params.id
      } }).then(<span class="fstat-no" title="function not covered" >(</span>data) =&gt; {
<span class="cstat-no" title="statement not covered" >        if (data) {</span>
<span class="cstat-no" title="statement not covered" >          return res.status(400)</span>
          .send({ error: { message: 'user already in group' } });
        }
<span class="cstat-no" title="statement not covered" >        return models.GroupUsers</span>
          .create({
            userId: req.body.userId,
            groupId: req.params.id
          })
          .then(<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >result =&gt; res.status(201).send(result))</span></span>
          .catch(<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >error =&gt; res.status(400).send(error));</span></span>
      });
  },
  upsert(req, res) {
    <span class="missing-if-branch" title="if path not taken" >I</span>if (!req.body.users) {
<span class="cstat-no" title="statement not covered" >      res.status(400)</span>
      .send({ error: { message: 'Param: "users" is required' } });
<span class="cstat-no" title="statement not covered" >      return;</span>
    }
&nbsp;
    <span class="missing-if-branch" title="if path not taken" >I</span>if (!req.params.id) {
<span class="cstat-no" title="statement not covered" >      res.status(400)</span>
      .send({ error: { message: 'Param: "group_id" is required' } });
<span class="cstat-no" title="statement not covered" >      return;</span>
    }
&nbsp;
    JSON.parse(req.body.users).map(user =&gt;
      models.Users.findAll({ where: { id: user.id } })
      .then((existingUser) =&gt; {
        <span class="missing-if-branch" title="else path not taken" >E</span>if (existingUser.length === 0) {
          res.status(404).send({ message: 'User does not exist' });
        } else {
<span class="cstat-no" title="statement not covered" >          models.GroupUsers</span>
          .findOne({ where: { userId: user.id, groupId: req.params.id } })
          .then(<span class="fstat-no" title="function not covered" >(</span>result) =&gt; {
<span class="cstat-no" title="statement not covered" >            if (result !== null) {</span>
<span class="cstat-no" title="statement not covered" >              models.GroupUsers.destroy({ where: { userId: user.id, groupId: req.params.id } });</span>
            } else {
<span class="cstat-no" title="statement not covered" >              models.GroupUsers.create({ userId: user.id, groupId: req.params.id });</span>
=======
export default {
  addOrRemoveUser(req, res) {
    <span class="missing-if-branch" title="if path not taken" >I</span>if (!req.body.usersIds) {
<span class="cstat-no" title="statement not covered" >      return res.status(400).send({ error: 'Param: "users" is required', status: 400 });</span>
    }
&nbsp;
    <span class="missing-if-branch" title="if path not taken" >I</span>if (!req.params.id) {
<span class="cstat-no" title="statement not covered" >      return res.status(400).send({ error: 'Param: "group_id" is required', status: 400 });</span>
    }
&nbsp;
    models.Groups
    .findOne({ where: { id: req.params.id } })
    .then((foundGroup) =&gt; {
      <span class="missing-if-branch" title="if path not taken" >I</span>if (!foundGroup) {
<span class="cstat-no" title="statement not covered" >        return res.status(404).send({ error: 'Group does not exist', status: 404 });</span>
      }
      res.status(200).send({ message: 'Group members list updated', status: 200 });
    });
&nbsp;
    JSON.parse(req.body.usersIds).map(({ id }) =&gt;
      models.Users.findOne({ where: { id } })
      .then((userFound) =&gt; {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (userFound) {
<span class="cstat-no" title="statement not covered" >          models.GroupUsers</span>
          .findOne({ where: { userId: id, groupId: req.params.id } })
          .then(<span class="fstat-no" title="function not covered" >(</span>foundUser) =&gt; {
<span class="cstat-no" title="statement not covered" >            if (foundUser !== null) {</span>
<span class="cstat-no" title="statement not covered" >              models.GroupUsers.destroy({ where: { userId: id, groupId: req.params.id } });</span>
            } else {
<span class="cstat-no" title="statement not covered" >              models.GroupUsers.create({ userId: id, groupId: req.params.id });</span>
>>>>>>> b1ace67e1b07e666bbdd8ad156e8bfd1e6a20a55
            }
          });
        }
      })
    );
<<<<<<< HEAD
  },
  update(req, res) {
<span class="cstat-no" title="statement not covered" >    return models.GroupUsers</span>
      .update({
        update_trigger: Math.floor((Math.random() * 10000) + 1) },
      { where: {
        user_id: req.body.user_id,
        group_id: req.body.group_id
      }
      })
      .then(<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >result =&gt; res.status(202).send(result))</span></span>
      .catch(<span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >error =&gt; res.status(400).send(error));</span></span>
=======
>>>>>>> b1ace67e1b07e666bbdd8ad156e8bfd1e6a20a55
  }
};
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
<<<<<<< HEAD
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Wed Aug 16 2017 11:59:53 GMT+0100 (WAT)
=======
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Fri Aug 18 2017 18:23:20 GMT+0100 (WAT)
>>>>>>> b1ace67e1b07e666bbdd8ad156e8bfd1e6a20a55
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
